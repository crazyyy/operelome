function YandexMaps(){this.mapId,this.selectId,this.addressSearchId,this.addressSearchResultsId,this.map=null,this.maOptions={center:[55.757478937200084,37.62277964550782],zoom:11,behaviors:["default","scrollZoom"],controls:["zoomControl"]},this.clusterer=new ymaps.Clusterer({groupByCoordinates:!1,preset:"islands#invertedBlueClusterIcons"}),this.ajax_url="http://operelome.ru/wp-admin/admin-ajax.php?action=travmpunkts",this.template='<div class="travmpunkt"><div class="title">{title}</div><div class="address">Адрес: <strong>{address}</strong></div><div class="phone">Телефон: <strong>{phone}</strong></div><div class="hours">Время работы: <strong>{hours}</strong></div></div>',this.init=function(){this.map=new ymaps.Map(this.mapId,this.maOptions),this.map.controls.add(new ymaps.control.FullscreenControl({options:{position:{right:20,bottom:20}}})),this.loadPlacemarks(null),this.addCityChangeHandler(),this.addSearchHandler()},this.loadPlacemarks=function(e){var t=this;$.get(this.ajax_url,{city:e},function(s){t.removeAllPacemarks(),t.createPlacemarks(s),e&&s.length&&t.setLocation(e)},"json")},this.removeAllPacemarks=function(){this.clusterer.removeAll()},this.createPlacemarks=function(e){var t=this;$.each(e,function(e,s){var a=t.createPlacemark(s);t.clusterer.add(a)}),this.map.geoObjects.add(this.clusterer)},this.createPlacemark=function(e){var t=this,s=[e.y,e.x],a=this.template;a=a.replace("{title}",e.title),a=a.replace("{address}",e.geo_address),a=a.replace("{phone}",e.geo_phone),a=a.replace("{hours}",e.geo_work_hours);var r=new ymaps.Placemark(s,{balloonContent:a,hintContent:e.geo_city+" "+e.title},{preset:"islands#blueCircleIcon"});return r.events.add("click",function(e){t.clickPlacemark(e.get("target"))}),r},this.clickPlacemark=function(e){},this.setLocation=function(e){var t=this;ymaps.geocode("Россия, "+e,{results:1}).then(function(e){t.map.setCenter(e.geoObjects.get(0).geometry.getCoordinates(),11,{checkZoomRange:!0,duration:1e3})})},this.addCityChangeHandler=function(){var e=this;$("#"+this.selectId).on("change",function(){var t=$(this).val();e.loadPlacemarks(t)})},this.addSearchHandler=function(){var e=this,t="#"+this.addressSearchId,s="#"+this.addressSearchResultsId;$(t).on("keyup",function(e){var t=e.which;37!=t&&38!=t&&39!=t&&40!=t&&13!=t&&$(this).trigger("ymaps-search-places")}),$(t).on("ymaps-search-places",function(){var e=$(this).val();return""==e?void $(s).empty().hide():void ymaps.geocode("Россия, "+e,{results:5}).then(function(e){var t=e.geoObjects.getLength();if(t){$(s).empty().show();for(var a=0;t>a;a++){var r=e.geoObjects.get(a),n=r.properties.get("name")+" "+r.properties.get("description"),i=r.geometry.getCoordinates().join(" ");$(s).append($("<div>").append($("<span>").append(n).attr("data-coord",i)))}}else $(s).empty().hide()})}),$(s).on("click","span",function(){var t=$(this).attr("data-coord").split(" ");$(s).empty().hide(),e.map.setCenter(t,11,{checkZoomRange:!0,duration:1e3})})}}$(function(){window.ymaps&&ymaps.ready(function(){var e=new YandexMaps;e.mapId="map-travmpunkts",e.selectId="map-travmpunkts-select",e.addressSearchId="map-travmpunkts-address",e.addressSearchResultsId="map-travmpunkts-address-results",e.init()})});